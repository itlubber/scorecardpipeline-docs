

<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
  <head>
    <meta charset="utf-8" />
      <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="scorecardpipeline" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="0.1.38" />
    <meta name="docsearch:version" content="" />
    
      <title>简介 &mdash; scorecardpipeline 0.1.38 文档</title>
    
    <link rel="stylesheet" href="_static/bootstrap-icons.css" type="text/css" />
          <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
          <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
          <link id="pygments_dark_css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css" href="_static/pygments_dark.css" />
          <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
          <link rel="stylesheet" type="text/css" href="_static/colorsets/sphinx-nefertiti-indigo.min.css" />
          <link rel="stylesheet" type="text/css" href="_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="_static/fonts/red-hat-mono/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="_static/fonts/nunito/stylesheet.css" />
          <link rel="stylesheet" type="text/css" href="_static/pygments_dark.css" />
        <link rel="index" title="索引" href="genindex.html" />
        <link rel="search" title="搜索" href="search.html" />
        <link rel="top" title="scorecardpipeline 0.1.38 文档" href="#" />
        <link rel="next" title="scorecardpipeline" href="scorecardpipeline.html" />
        <link rel="prev" title="scorecardpipeline" href="index.html" />
    <style>
      :root {
        --nftt-body-font-family: "Nunito", var(--nftt-font-sans-serif) !important;
        --nftt-font-monospace: "Red Hat Mono", var(--nftt-font-family-monospace) !important;
        --nftt-project-name-font: "Nunito", var(--nftt-body-font-family);
        --nftt-documentation-font: "Nunito", var(--nftt-body-font-family);
        --nftt-doc-headers-font: "Nunito", var(--nftt-documentation-font);}
      h1 *, h2 *, h3 *, h4 *, h5 *, h6 * { font-size: inherit; }
    </style>
  </head>
  <body>
    <header class="navbar navbar-expand-lg navbar-dark nftt-navbar flex-column fixed-top">
      <div class="skip-links container-xxl visually-hidden-focusable overflow-hidden justify-content-start">
        <div class="border-bottom mb-2 pb-2 w-100">
          <a class="d-none d-md-inline-flex p-2 m-1" href="#sidebar-filter">Skip to docs navigation</a>
          <a class="d-inline-flex p-2 m-1" href="#content">Skip to main content</a>
        </div>
      </div>
      <nav class="container-xxl nftt-gutter flex-wrap flex-lg-nowrap" aria-label="Main navigation">
        <div class="nftt-navbar-toggler">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle documentation navigation">
            <i class="bi bi-list"></i>
          </button>
        </div>
          <a href="index.html"
              
              class="navbar-brand p-0 me-0 md-lg-2"
          ><span class="brand-text">scorecardpipeline</span></a>
        
        <div class="d-flex d-lg-none">
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttSearch" aria-controls="nfttSearch" aria-label="Search">
            <i class="bi bi-search"></i>
          </button>
          <button class="navbar-toggler p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#nfttNavbar" aria-controls="nfttNavbar" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
        </div>
        
<div class="offcanvas-lg offcanvas-end flex-grow-1" tabindex="-1" id="nfttSearch" aria-labelledby="nfttSearchOffcanvasLabel" data-bs-scroll="true">
  <div class="offcanvas-header px-4 pb-0">
    <h5 class="offcanvas-title fw-bold" id="nfttSearchOffcanvasLabel">Search the documentation</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttSearch"></button>
  </div>
  <div class="offcanvas-body p-4 pt-0 p-lg-0 px-lg-3">
    <hr class="d-lg-none text-white-50">
    <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
      <li class="nav-item col-12 col-lg-auto">
        <form id="nftt-search-form" action="search.html" method="get">
          <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search docs" aria-label="Search" aria-describedby="button-search">
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <button class="btn btn-primary" type="submit" id="button-search" aria-label="Search"><i class="bi bi-search"></i></button>
          </div>
        </form>
      </li>
    </ul>
  </div>
</div>

        <div class="offcanvas-lg offcanvas-end" tabindex="-1" id="nfttNavbar" aria-labelledby="nfttNavbarOffcanvasLabel" data-bs-scroll="true">
          <div class="offcanvas-header px-4 pb-0">
            <div class="offcanvas-title text-white fw-bold" id="nfttNavbarOffcanvasLabel"><span class="brand-text">Nefertiti for Sphinx</span></div>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#nfttNavbar"></button>
          </div>
          <div class="offcanvas-body p-4 pt-0 p-lg-0">
            <hr class="d-lg-none text-white-50">
            <ul class="navbar-nav flex-row align-items-center flex-wrap ms-md-auto">
              
              <li class="nav-item col-12 col-lg-auto">
                <a class="nav-link py-2 py-lg-0 px-0 px-lg-2" href="https://github.com/itlubber/scorecardpipeline" target="_blank" rel="noopener">
                  <div class="d-flex align-items-center">
                    <div class="me-2">
                      <i class="bi bi-git size-24"></i>
                    </div>
                    <div class="repo d-flex flex-column align-items-center" data-snftt-repo-url="https://github.com/itlubber/scorecardpipeline">
                      itlubber/scorecardpipeline
                      <div class="d-flex justify-content-center" data-snftt-repo-metrics>
                        <span class="pe-2 d-flex justify-content-center align-items-center">
                          <i class="bi bi-tag size-14"></i>
                          <span class="repo-metric" data-snftt-repo-tag></span>
                        </span>
                        <span class="pe-2 d-flex justify-content-center align-items-center">
                          <i class="bi bi-star size-14"></i>
                          <span class="repo-metric" data-snftt-repo-stars></span>
                        </span>
                        <span class="d-flex justify-content-center align-items-center">
                          <i class="bi bi-diagram-2 size-14"></i>
                          <span class="repo-metric" data-snftt-repo-forks></span>
                        </span>
                      </div>
                    </div>
                  </div>
                </a>
              </li>
              <li class="nav-item col-12 col-lg-auto h-100" aria-hidden="true">
                <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div>
                <hr class="d-lg-none text-white-50">
              </li>
              
              <!-- version_dropdown.html -->

  
    <li class="nav-item dropdown">
      <a class="nav-link d-flex py-2 px-0 px-lg-2 dropdown-toggle align-items-center" id="snftt-version" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Select version">
        <span id="snftt-version-text" class="d-lg-none small">scorecardpipeline</span>
        <span class="small ms-2" data-snftt-version-active="v0.1.38">v0.1.38</span>
      </a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-version-text">
        <li>
          <h6 class="dropdown-header">Versions</h6>
        </li>
        
          <li>
            <a class="dropdown-item d-flex align-items-center justify-content-between" aria-pressed="false" href="https://itlubber.github.io/scorecardpipeline-docs" data-snftt-version-url="https://itlubber.github.io/scorecardpipeline-docs" data-snftt-version="v0.1.38">
              <span class="small ms-2">v0.1.38</span>
              <i class="bi bi-check ms-auto"></i>
            </a>
          </li>
        
      </ul>
    </li>
  

  <li class="nav-item col-12 col-lg-auto h-100" aria-hidden="true">
    <div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div>
    <hr class="d-lg-none text-white-50">
  </li>

              
              <!-- colorscheme_dropdown.html -->
<li class="nav-item dropdown">
  <a class="nav-link d-flex py-2 px-0 px-lg-2 dropdown-toggle align-items-center" id="snftt-luz" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false" aria-label="Toggle light/dark">
    <i class="bi bi-circle-half" data-snftt-luz-icon-active></i>
    <span id="snftt-luz-text" class="d-lg-none small ms-2">Toggle light/dark</span>
  </a>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="snftt-luz-text">
    <li>
      <h6 class="dropdown-header">Light/dark</h6>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="light" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-sun" data-snftt-luz-icon="light"></i>
        </span>
        <span class="small ms-3">Light</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item d-flex align-items-center" data-snftt-luz="dark" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-moon-stars" data-snftt-luz-icon="dark"></i>
        </span>
        <span class="small ms-3">Dark</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
    <li>
      <a class="dropdown-item current d-flex align-items-center" data-snftt-luz="default" href="#" aria-pressed="false">
        <span class="small">
          <i class="bi bi-circle-half" data-snftt-luz-icon="default"></i>
        </span>
        <span class="small ms-3">Default</span>
        <i class="bi bi-check ms-auto"></i>
      </a>
    </li>
  </ul>
</li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container-xxl nftt-gutter nftt-layout">
      <aside class="nftt-sidebar">
        <div class="title d-none d-md-block">
          <i class="bi bi-book"></i>&nbsp;&nbsp;<span>Table of contents</span>
        </div>
        <div id="sidebar" tabindex="-1" class="offcanvas-lg offcanvas-start" aria-labelledby="nfttSidebarOffcanvasLabel">
            <!-- danirus sidebartemplate: "globaltoc.html" --><div class="offcanvas-header border-bottom">
  <h5 class="offcanvas-title" id="nfttSidebarOffcanvasLabel">
    Table of contents
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close" data-bs-target="#sidebar"></button>
</div>

<div class="offcanvas-body">
  <nav class="toc" aria-label="Main menu">
    <div class="mb-3 p-1 pt-3 pb-4 border-bottom">
      <input id="sidebar-filter" type="text" name="filter" class="form-control form-control-sm" placeholder="filter" aria-label="filter">
    </div>
    <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id2">版本说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id3">环境安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id4">使用示例</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id16">交流</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html">scorecardpipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.processing">scorecardpipeline.processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.feature_selection">scorecardpipeline.feature_selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.model">scorecardpipeline.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.auto_eda">scorecardpipeline.auto_eda</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.auto_report">scorecardpipeline.auto_report</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.utils">scorecardpipeline.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.excel_writer">scorecardpipeline.excel_writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.rule">scorecardpipeline.rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.rule_extraction">scorecardpipeline.rule_extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="scorecardpipeline.html#module-scorecardpipeline.logger">scorecardpipeline.logger</a></li>
</ul>

  </nav>
  <template data-toggle-item-template>
    <button class="btn btn-sm btn-link toctree-expand" type="button">
      <i class="bi bi-caret-right"></i>
      <span class="visually-hidden">Toggle menu contents</span>
    </button>
  </template>
</div>
        </div>
      </aside>
      <main class="nftt-main">
        <article id="content" class="nftt-content" role="main">
    <section id="id1">
<h1>简介</h1>
<p><code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 封装了 <code class="docutils literal notranslate"><span class="pre">toad</span></code>、<code class="docutils literal notranslate"><span class="pre">scorecardpy</span></code>、<code class="docutils literal notranslate"><span class="pre">optbinning</span></code> 等评分卡建模相关组件，<code class="docutils literal notranslate"><span class="pre">API</span></code> 风格与 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 高度一致，支持 <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> 式端到端评分卡建模、模型报告输出、导出 <code class="docutils literal notranslate"><span class="pre">PMML</span></code> 文件、超参数搜索等功能。</p>
<blockquote>
<div><p>在线文档: <a class="reference external" href="https://scorecardpipeline.itlubber.art//"><code class="docutils literal notranslate"><span class="pre">https://scorecardpipeline.itlubber.art/</span></code></a></p>
<p><code class="docutils literal notranslate"><span class="pre">PIPY</span></code> 包: <a class="reference external" href="https://pypi.org/project/scorecardpipeline/"><code class="docutils literal notranslate"><span class="pre">https://pypi.org/project/scorecardpipeline</span></code></a></p>
<p>仓库地址: <a class="reference external" href="https://github.com/itlubber/scorecardpipeline"><code class="docutils literal notranslate"><span class="pre">https://github.com/itlubber/scorecardpipeline</span></code></a></p>
</div></blockquote>
</section>
<section id="id2">
<h1>版本说明</h1>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"><strong>序号</strong></th>
<th style="text-align: center;"><strong>版本号</strong></th>
<th style="text-align: center;"><strong>发布日期</strong></th>
<th style="text-align: center;"><strong>版本说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">01</td>
<td style="text-align: center;">0.1.0</td>
<td style="text-align: center;">2023.05.04</td>
<td style="text-align: center;">初始化</td>
</tr>
<tr>
<td style="text-align: center;">..</td>
<td style="text-align: center;">......</td>
<td style="text-align: center;">......</td>
<td style="text-align: center;">......</td>
</tr>
<tr>
<td style="text-align: center;">26</td>
<td style="text-align: center;">0.1.26</td>
<td style="text-align: center;">2023.11.13</td>
<td style="text-align: center;">稳定版本，新增方法<a href="https://itlubber.github.io/scorecardpipeline-docs/"><code>说明文档</code></a></td>
</tr>
<tr>
<td style="text-align: center;">27</td>
<td style="text-align: center;">0.1.27</td>
<td style="text-align: center;">2023.12.09</td>
<td style="text-align: center;">修复分类变量空值导致转评分卡异常报错及其他相关问题</td>
</tr>
<tr>
<td style="text-align: center;">28</td>
<td style="text-align: center;">0.1.28</td>
<td style="text-align: center;">2023.12.15</td>
<td style="text-align: center;">修复sklearn版本问题、新增自动EDA方法 <code>auto_eda_sweetviz</code></td>
</tr>
<tr>
<td style="text-align: center;">29</td>
<td style="text-align: center;">0.1.29</td>
<td style="text-align: center;">2023.12.29</td>
<td style="text-align: center;">新增三方数据测试报告输出方法 <code>auto_data_testing_report</code> 及示例文件 <code>examples/model_report/三方数据测试报告.xlsx</code></td>
</tr>
<tr>
<td style="text-align: center;">30</td>
<td style="text-align: center;">0.1.30</td>
<td style="text-align: center;">2024.01.29</td>
<td style="text-align: center;"></td>
</tr>
<tr>
<td style="text-align: center;">31</td>
<td style="text-align: center;">0.1.31</td>
<td style="text-align: center;">2024.02.28</td>
<td style="text-align: center;">新增 <code>rule.Rule</code> 规则集相关内容、修复 <code>processing.Combiner.load</code> 方法</td>
</tr>
<tr>
<td style="text-align: center;">32</td>
<td style="text-align: center;">0.1.32</td>
<td style="text-align: center;">2024.02.29</td>
<td style="text-align: center;">合并 <code>pdtr</code> 内容，新增 <code>rule_extraction.DecisionTreeRuleExtractor</code> 决策树策略挖掘方法</td>
</tr>
<tr>
<td style="text-align: center;">33</td>
<td style="text-align: center;">0.1.33</td>
<td style="text-align: center;">2024.03.07</td>
<td style="text-align: center;"><code>excel_writer.ExcelWriter</code> 支持多层级索引存储、多层级表头存储、多列合并单元格等功能</td>
</tr>
<tr>
<td style="text-align: center;">34</td>
<td style="text-align: center;">0.1.34</td>
<td style="text-align: center;">预发布</td>
<td style="text-align: center;">修复异常、部分新功能上线 QaQ</td>
</tr>
</tbody>
</table>
</section>
<section id="id3">
<h1>环境安装</h1>
<ol class="arabic simple">
<li><p>安装 <code class="docutils literal notranslate"><span class="pre">python</span></code> 环境</p></li>
</ol>
<p>推荐 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.8.13</span></code> ，参照网上教程自行安装即可，也可直接使用系统提供的 <code class="docutils literal notranslate"><span class="pre">python3</span></code> , 版本不易过高, 最低支持 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.6</span></code>，最高支持 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.10</span></code></p>
<ol class="arabic simple" start="2">
<li><p>安装 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 包</p></li>
</ol>
<ul class="simple">
<li><p>在线环境安装</p></li>
</ul>
<p>直接通过 <code class="docutils literal notranslate"><span class="pre">pip</span></code> 安装即可，安装后需要确认下版本是否安装正确，推荐 <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">https://test.pypi.org/simple</span></code> 指定源安装</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>scorecardpipeline
</pre></div>
</div>
<ul class="simple">
<li><p>离线环境安装</p></li>
</ul>
<p>离线环境安装需先找一个 <code class="docutils literal notranslate"><span class="pre">python</span></code> 版本和系统 (<code class="docutils literal notranslate"><span class="pre">windows</span></code>、<code class="docutils literal notranslate"><span class="pre">linux</span></code>、<code class="docutils literal notranslate"><span class="pre">mac</span></code>) 与生产一致的有网机器或者容器，在有网的环境中下载相关依赖项后拷贝到离线环境安装</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在线环境依赖下载</span>
pip<span class="w"> </span>download<span class="w"> </span>-d<span class="w"> </span>site-packages/<span class="w"> </span>scorecardpipeline
<span class="c1"># 离线环境</span>
pip<span class="w"> </span>install<span class="w"> </span>--no-index<span class="w"> </span>--find-links<span class="o">=</span>site-packages<span class="w"> </span>scorecardpipeline
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装 <code class="docutils literal notranslate"><span class="pre">jdk</span> <span class="pre">1.8+</span></code> [可选]</p></li>
</ol>
<p>如果有将训练完成的评分卡模型直接导出 <code class="docutils literal notranslate"><span class="pre">PMML</span></code> 模型文件部署的需求，需要单独安装 <code class="docutils literal notranslate"><span class="pre">java</span></code> 环境</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">mac</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">windows</span></code> 参考: <a class="reference external" href="https://developer.aliyun.com/article/1082599"><code class="docutils literal notranslate"><span class="pre">https://developer.aliyun.com/article/1082599</span></code></a></p>
<p><code class="docutils literal notranslate"><span class="pre">linux</span></code> 参考: <a class="reference external" href="https://blog.csdn.net/muzi_gao/article/details/132169159"><code class="docutils literal notranslate"><span class="pre">https://blog.csdn.net/muzi_gao/article/details/132169159</span></code></a></p>
</div></blockquote>
</section>
<section id="id4">
<h1>使用示例</h1>
<p>本节将就 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 的相关功能做简要介绍，并提供一个<a class="reference external" href="https://github.com/itlubber/scorecardpipeline/blob/main/examples/scorecard_samples.ipynb"><code class="docutils literal notranslate"><span class="pre">简单的示例</span></code></a>，旨在让读者对如何使用 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 进行评分卡模型构建有一个简单的印象。</p>
<section id="id5">
<h2>导入依赖</h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">scorecardpipeline</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># 固定随机种子以保证结果可复现</span>
<span class="n">init_setting</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id6">
<h2>数据准备</h2>
<p>使用 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 进行评分卡建模，需要您提前准备好一个包含目标变量的数据集，<code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 提供了一个德国信贷数据集 <a class="reference external" href="https://archive.ics.uci.edu/dataset/144/statlog+german+credit+data"><code class="docutils literal notranslate"><span class="pre">germancredit</span></code></a>，示例加载该数据集进行演示，读者可以直接替换为您本地的数据集，并修改目标变量名称为数据集中的目标变量列名</p>
<p><a class="reference external" href="https://archive.ics.uci.edu/dataset/144/statlog+german+credit+data"><code class="docutils literal notranslate"><span class="pre">germancredit</span></code></a> 数据集中包含类别型变量、数值型变量、好坏标签，共1000条数据，由于数据集中不包含缺失值，为了模拟实际生产中的真实数据，笔者将在固定随机种子的情况下随机替换数据集中的部分内容为 <code class="docutils literal notranslate"><span class="pre">np.nan</span></code></p>
<!-- 
<details>

  <summary>数据字典</summary> -->
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"><strong>序号</strong></th>
<th style="text-align: center;"><strong>类型</strong></th>
<th style="text-align: center;"><strong>特征名</strong></th>
<th style="text-align: center;"><strong>释义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">creditability</td>
<td style="text-align: center;">客户好坏标签</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">duration in month</td>
<td style="text-align: center;">月持续时间</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">credit amount</td>
<td style="text-align: center;">信用额度</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">installment rate in percentage of disposable income</td>
<td style="text-align: center;">分期付款率占可支配收入的百分比</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">present residence since</td>
<td style="text-align: center;">现居住地至今</td>
</tr>
<tr>
<td style="text-align: center;">5</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">age in years</td>
<td style="text-align: center;">年龄</td>
</tr>
<tr>
<td style="text-align: center;">6</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">number of existing credits at this bank</td>
<td style="text-align: center;">这家银行的现有信贷数量</td>
</tr>
<tr>
<td style="text-align: center;">7</td>
<td style="text-align: center;">数值型</td>
<td style="text-align: center;">number of people being liable to provide maintenance for</td>
<td style="text-align: center;">有责任为其提供维修服务的人数</td>
</tr>
<tr>
<td style="text-align: center;">8</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">status of existing checking account</td>
<td style="text-align: center;">现有支票账户的状态</td>
</tr>
<tr>
<td style="text-align: center;">9</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">credit history</td>
<td style="text-align: center;">信用记录</td>
</tr>
<tr>
<td style="text-align: center;">10</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">purpose</td>
<td style="text-align: center;">目的</td>
</tr>
<tr>
<td style="text-align: center;">11</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">savings account or bonds</td>
<td style="text-align: center;">储蓄账户/债券</td>
</tr>
<tr>
<td style="text-align: center;">12</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">present employment since</td>
<td style="text-align: center;">至今工作至今</td>
</tr>
<tr>
<td style="text-align: center;">13</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">personal status and sex</td>
<td style="text-align: center;">个人地位和性别</td>
</tr>
<tr>
<td style="text-align: center;">14</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">other debtors or guarantors</td>
<td style="text-align: center;">其他债务人/担保人</td>
</tr>
<tr>
<td style="text-align: center;">15</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">property</td>
<td style="text-align: center;">财产</td>
</tr>
<tr>
<td style="text-align: center;">16</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">other installment plans</td>
<td style="text-align: center;">其他分期付款计划</td>
</tr>
<tr>
<td style="text-align: center;">17</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">housing</td>
<td style="text-align: center;">住房情况</td>
</tr>
<tr>
<td style="text-align: center;">18</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">job</td>
<td style="text-align: center;">工作</td>
</tr>
<tr>
<td style="text-align: center;">19</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">telephone</td>
<td style="text-align: center;">电话</td>
</tr>
<tr>
<td style="text-align: center;">20</td>
<td style="text-align: center;">类别型</td>
<td style="text-align: center;">foreign worker</td>
<td style="text-align: center;">外籍工人</td>
</tr>
</tbody>
</table>
<!-- </details> -->
<br>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 加载数据集</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">germancredit</span><span class="p">()</span>

<span class="c1"># 设置目标变量名称 &amp; 映射目标变量值域为 {0, 1}</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;creditability&quot;</span>
<span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;good&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;bad&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="c1"># 随机替换 20% 的数据为 np.nan</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</section>
<section id="id7">
<h2>数据拆分</h2>
<p>通常建模过程中会将数据集拆分成训练数据集和测试数据集集，训练数据集用于模型参数的训练，测试数据集用于评估模型好坏，且在整个建模过程中实际上只能使用一次（任何针对测试数据集调模型的，都存在模型过拟合的情况，除非你的数据不包含任何噪声数据）。而为了弥补测试数据集只能用一次用于评估模型好坏的尴尬，大多都会再拆分一个验证数据集，用于模型训练过程中判别模型是否向好的方向进行优化。</p>
<p>在金融建模场景中，上述三个数据集通常被称为训练数据集、测试数据集（即上述三个数据集中的验证集）、跨时间验证集（即上述三个数据集中的测试集）。同时，在金融场景中，跨时间验证集的拆分方式通常使用类似时间序列数据集的拆分方法，按照时间将数据集拆分为建模集（包含训练集和测试集）、跨时间验证集（<code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">of</span> <span class="pre">Time，OOT</span></code>），以保证模型在不同时间段内的泛化能力。</p>
<p>简单起见，示例只拆分训练集、测试集，OOT直接拷贝训练集来演示评分卡建模完整过程。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>

<span class="n">oot</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>数据预处理</h2>
<p>在评分卡建模标准流程中，会先针对每个变量分箱后转WOE，再筛选特征训练逻辑回归模型，训练完后转评分卡，当数据集的特征个数比较多时，可以再分箱之前先进行特征初筛，以降低分箱时的计算耗时。评分卡建模完整流程可以参照如下流程:</p>
<div style="display: flex; justify-content: space-around;">
    <img src="https://itlubber.art/upload/scorecard-modeling-process.png" style="width: 70%; "/>
</div>
<section id="id9">
<h3>特征筛选</h3>
<p>特征筛选主要从几个方面来评估特征是否有效：</p>
<ol class="arabic simple">
<li><p>单一值占比</p></li>
<li><p>缺失值占比</p></li>
<li><p>特征相关性</p></li>
<li><p>特征 <code class="docutils literal notranslate"><span class="pre">IV（information</span> <span class="pre">value）</span></code> 值</p></li>
<li><p>特征稳定性 <code class="docutils literal notranslate"><span class="pre">PSI（population</span> <span class="pre">stability</span> <span class="pre">index）</span></code></p></li>
<li><p>特征重要性</p></li>
<li><p>方差膨胀因子 <code class="docutils literal notranslate"><span class="pre">VIF（variance</span> <span class="pre">inflation</span> <span class="pre">factor）</span></code></p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 提供了几种常见的特征筛选方法（<code class="docutils literal notranslate"><span class="pre">1</span></code>、<code class="docutils literal notranslate"><span class="pre">2</span></code>、<code class="docutils literal notranslate"><span class="pre">3</span></code>、<code class="docutils literal notranslate"><span class="pre">4</span></code>），可以通过实例化的方式进行配置，并在训练数据集中训练完成后应用到不同数据集中。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化筛选器</span>
<span class="n">select</span> <span class="o">=</span> <span class="n">FeatureSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;toad&quot;</span><span class="p">,</span> <span class="n">identical</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">iv</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">corr</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1"># 训练数据上训练</span>
<span class="n">select</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="c1"># 应用到不同数据集</span>
<span class="n">train_select</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">test_select</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中，所有筛选器都包含 <code class="docutils literal notranslate"><span class="pre">dropped</span></code> 属性，用来存放特征被剔除的原因。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 输出特征筛选信息</span>
<span class="n">select</span><span class="o">.</span><span class="n">dropped</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">variable</th>
<th style="text-align: center;">rm_reason</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">number_of_existing_credits_at_this_bank</td>
<td style="text-align: center;">iv</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">job</td>
<td style="text-align: center;">iv</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">number_of_people_being_liable_to_provide_maintenance_for</td>
<td style="text-align: center;">iv</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">telephone</td>
<td style="text-align: center;">iv</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: center;">duration_in_month</td>
<td style="text-align: center;">corr</td>
</tr>
</tbody>
</table>
</section>
<section id="id10">
<h3>特征分箱</h3>
<p>特征分箱能够提升模型的鲁棒性，特征分箱时通常对每个箱内的样本个数或占比有要求，数据中的异常值和极端值会被分到某个箱中，在转化为 <code class="docutils literal notranslate"><span class="pre">WOE</span></code> 之后能够很大程度上避免异常值或极端值对模型训练时造成偏差。同时，特征分箱转 <code class="docutils literal notranslate"><span class="pre">WOE</span></code> 之后，所有特征的值域都被缩放到了某个固定尺度下，逻辑回归模型的系数在一定程度上能够代表特征的重要程度。</p>
<ul class="simple">
<li><p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中，集成了 <code class="docutils literal notranslate"><span class="pre">toad</span></code> 和 <code class="docutils literal notranslate"><span class="pre">optbinning</span></code> 两个库中提供的分箱方法，后续会陆续增加更多的分箱方法，相关内容参考: <a class="reference internal" href="#/scorecardpipeline.html#scorecardpipeline.Combiner"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">scorecardpipeline.Combiner</span></code></span></a></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化分箱器</span>
<span class="n">combiner</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">min_bin_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># 训练</span>
<span class="n">combiner</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_select</span><span class="p">)</span>
<span class="c1"># 对数据集进行分箱</span>
<span class="n">train_bins</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_select</span><span class="p">)</span>
<span class="n">test_bins</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_select</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>为了方便调整分箱，<a class="reference internal" href="#"><span class="xref myst"><code class="docutils literal notranslate"><span class="pre">scorecardpipeline.Combiner</span></code></span></a> 提供了输出分箱图和分箱统计信息的功能，方便快速手工调整分箱。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看 credit_amount 信用额度 的分箱信息，并显示分箱统计信息</span>
<span class="n">combiner</span><span class="o">.</span><span class="n">bin_plot</span><span class="p">(</span><span class="n">train_select</span><span class="p">,</span> <span class="s2">&quot;credit_amount&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;信用额度&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around;">
    <img src="https://itlubber.art/upload/sp_credit_amount.png" />
</div>
<ul class="simple">
<li><p>当特征分箱不符合业务逻辑或者单调性不满足时，可以通过自定义规则的方式查看分箱效果。（此时不会对 <code class="docutils literal notranslate"><span class="pre">Combiner</span></code> 中的规则进行更新）</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 通过 rule 字段传入自定义规则，实时查看分箱效果</span>
<span class="n">combiner</span><span class="o">.</span><span class="n">bin_plot</span><span class="p">(</span><span class="n">train_select</span><span class="p">,</span> <span class="s2">&quot;credit_amount&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;信用额度&quot;</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="p">[</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around;">
    <img src="https://itlubber.art/upload/sp_credit_amount_rule.png" />
</div>
<ul class="simple">
<li><p>当特征分箱调整到符合业务预期或者单调满足建模需求时，可以通过 <code class="docutils literal notranslate"><span class="pre">update</span></code> 方法更新规则 <code class="docutils literal notranslate"><span class="pre">Combiner</span></code> 中的规则。</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 更新 credit_amount 的分箱规则</span>
<span class="n">combiner</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;credit_amount&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]})</span>
<span class="c1"># 打印分箱规则</span>
<span class="n">combiner</span><span class="p">[</span><span class="s2">&quot;credit_amount&quot;</span><span class="p">]</span> <span class="c1"># array([4000.,   nan])</span>
</pre></div>
</div>
</section>
<section id="woe">
<h3><code class="docutils literal notranslate"><span class="pre">WOE</span></code> 转换</h3>
<p>特征分箱后，只是将特征离散化为几箱，每一箱的值被赋予了一个标签，例如0、1、2、3、…，尽管这些标签在一定程度上也能够表征客户的风险水平，能够作为训练数据训练出一个模型，但在评估客户风险状况时很难精准刻画客户的风险状况。</p>
<p>通常使用 <code class="docutils literal notranslate"><span class="pre">WOE（Weight</span> <span class="pre">of</span> <span class="pre">Evidence）编码</span></code> 对分箱后的特征进行编码。<code class="docutils literal notranslate"><span class="pre">WOE编码</span></code> 将每个分箱内的坏样本占比除以好样本占比后取对数来编码，能够反映每个分箱内客户的坏客户分布与好客户分布之间的差异以及该箱内坏好比与总体的坏好比之间的差异性。</p>
<p>特征 <code class="docutils literal notranslate"><span class="pre">WOE（Weight</span> <span class="pre">of</span> <span class="pre">Evidence）编码</span></code> 后，有如下好处：</p>
<ul class="simple">
<li><p>能够将每个特征的值域放缩到同样的尺度下</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woe</span></code> 中包含了样本好坏信息，比原始值和分箱序号更能反应客户违约概率大小</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woe</span></code> 的计算公式 <span class="math notranslate nohighlight">\(woe = ln(\frac{bad_i}{bad}/\frac{good_i}{good} )\)</span> 中引入了非线性，一定程度能够增强逻辑回归拟合非线性模型的能力</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化 WOE 转换器</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">WOETransformer</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="c1"># 训练</span>
<span class="n">transform</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_bins</span><span class="p">)</span>
<span class="c1"># 转换分箱为WOE</span>
<span class="n">train_woe</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_bins</span><span class="p">)</span>
<span class="n">test_woe</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_bins</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WOE（Weight</span> <span class="pre">of</span> <span class="pre">Evidence）编码器</span></code> 提供了方法允许使用者通过如下方式查看每个分箱对应的 <code class="docutils literal notranslate"><span class="pre">woe</span></code> 值。</p>
<div style="display: flex; justify-content: space-around;">
    <img src="https://itlubber.art/upload/sp_woetransformer.png" />
</div>
<p>在特征从原始值编码为 <code class="docutils literal notranslate"><span class="pre">woe</span></code> 的过程中，特征的值从连续值或者分类值映射到了有限的几个分箱对应的 <code class="docutils literal notranslate"><span class="pre">woe</span></code> 值，同时值域也统一到了一个基于样本好坏分布情况为基准的空间中，会造成特征之间的相关性增大、单一值占比上升、特征 <code class="docutils literal notranslate"><span class="pre">iv</span></code> 值较前筛时小幅度下降，所以推荐在 <code class="docutils literal notranslate"><span class="pre">WOE编码</span></code> 后，再进行一次特征精筛，以保证后续模型结果的稳定性和整体可解释性。</p>
</section>
<section id="id11">
<h3>逐步回归特征筛选</h3>
<p>在正式训练 <code class="docutils literal notranslate"><span class="pre">逻辑回归（logistic</span> <span class="pre">regression，LR）模型</span></code> 前，通常会再使用逐步回归来剔除特征，能够一定程度上解决特征之间的多重共线性，以及在剔除尽可能多的特征的同时保证 <code class="docutils literal notranslate"><span class="pre">LR模型</span></code> 效果的有效性。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化逐步回归特征筛选器</span>
<span class="n">stepwise</span> <span class="o">=</span> <span class="n">StepwiseSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="c1"># 训练</span>
<span class="n">stepwise</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_woe</span><span class="p">)</span>
<span class="c1"># 应用逐步回归特征筛选器</span>
<span class="n">train_woe_stepwise</span> <span class="o">=</span> <span class="n">stepwise</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_woe</span><span class="p">)</span>
<span class="n">test_woe_stepwise</span> <span class="o">=</span> <span class="n">stepwise</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_woe</span><span class="p">)</span>
</pre></div>
</div>
<p>与 <code class="docutils literal notranslate"><span class="pre">FeatureSelection</span></code> 类似，<code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中所有特征筛选器都包含了 <code class="docutils literal notranslate"><span class="pre">dropped</span></code> 属性，可以直接输出每个特征被剔除的原因。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 逐步回归特征筛选明细信息</span>
<span class="n">stepwise</span><span class="o">.</span><span class="n">dropped</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">variable</th>
<th style="text-align: center;">rm_reason</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">present_residence_since</td>
<td style="text-align: center;">stepwise</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">savings_account_and_bonds</td>
<td style="text-align: center;">stepwise</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">other_debtors_or_guarantors</td>
<td style="text-align: center;">stepwise</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">property</td>
<td style="text-align: center;">stepwise</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: center;">other_installment_plans</td>
<td style="text-align: center;">stepwise</td>
</tr>
<tr>
<td style="text-align: center;">5</td>
<td style="text-align: center;">foreign_worker</td>
<td style="text-align: center;">stepwise</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="lr">
<h2>训练 <code class="docutils literal notranslate"><span class="pre">LR</span></code> 模型</h2>
<p>对数据集预处理完成后，数据集中的特征的值域被映射到了一个与样本好坏息息相关的空间中，特征值的大小能够一定程度上反映出客户违约概率的高低，通过 <code class="docutils literal notranslate"><span class="pre">WOE编码</span></code> 方法对原始特征进行转换时引入的非线性能够在一定程度上弥补建模时使用简单模型拟合能力不足的问题，同时，数据集经过特征筛选后，冗余信息被尽可能多的剔除，多重共线性也在一定程度上得到解决，训练模型时能够在保证模型效果的前提下提升模型的鲁棒能力。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中，提供了基于 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 重新实现的 <code class="docutils literal notranslate"><span class="pre">ITLubberLogisticRegression</span></code> 逻辑回归模型，能够满足丰富的超参数设置和丰富的统计信息输出。</p>
<p>当然，假如您想直接使用 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 提供的 <code class="docutils literal notranslate"><span class="pre">LogisticRegression</span></code> 去完成评分卡模型构建和结果输出，也能够支持，但转换评分卡后，有部分扩展功能会受到限制，但不会影响评分卡模型转换、评分预测以及持久化存储的相关功能。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 逻辑回归模型构建</span>
<span class="n">logistic</span> <span class="o">=</span> <span class="n">ITLubberLogisticRegression</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="c1"># 训练</span>
<span class="n">logistic</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="p">)</span>
<span class="c1"># 预测数据集样本违约概率</span>
<span class="n">y_pred_train</span> <span class="o">=</span> <span class="n">logistic</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">logistic</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_woe_stepwise</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">target</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>逻辑回归模型训练完成后，能够通过 <code class="docutils literal notranslate"><span class="pre">summary</span></code> 或 <code class="docutils literal notranslate"><span class="pre">summary2</span></code> 方法输出模型训练时的各项统计信息</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 数据字典或特征描述信息</span>
<span class="n">feature_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;const&quot;</span><span class="p">:</span> <span class="s2">&quot;截距项&quot;</span><span class="p">,</span>
    <span class="s2">&quot;status_of_existing_checking_account&quot;</span><span class="p">:</span> <span class="s2">&quot;现有支票账户的状态&quot;</span><span class="p">,</span>
    <span class="s2">&quot;credit_history&quot;</span><span class="p">:</span> <span class="s2">&quot;信用记录&quot;</span><span class="p">,</span>
    <span class="s2">&quot;purpose&quot;</span><span class="p">:</span> <span class="s2">&quot;目的&quot;</span><span class="p">,</span>
    <span class="s2">&quot;credit_amount&quot;</span><span class="p">:</span> <span class="s2">&quot;信用额度&quot;</span><span class="p">,</span>
    <span class="s2">&quot;present_employment_since&quot;</span><span class="p">:</span> <span class="s2">&quot;现居住地至今&quot;</span><span class="p">,</span>
    <span class="s2">&quot;installment_rate_in_percentage_of_disposable_income&quot;</span><span class="p">:</span> <span class="s2">&quot;分期付款率占可支配收入的百分比&quot;</span><span class="p">,</span>
    <span class="s2">&quot;personal_status_and_sex&quot;</span><span class="p">:</span> <span class="s2">&quot;个人地位和性别&quot;</span><span class="p">,</span>
    <span class="s2">&quot;age_in_years&quot;</span><span class="p">:</span> <span class="s2">&quot;年龄&quot;</span><span class="p">,</span>
    <span class="s2">&quot;housing&quot;</span><span class="p">:</span> <span class="s2">&quot;住房情况&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># summary 仅支持输出简单的统计信息，使用 summary2 可以输出有特征描述的统计信息表</span>
<span class="n">logistic</span><span class="o">.</span><span class="n">summary2</span><span class="p">(</span><span class="n">feature_map</span><span class="o">=</span><span class="n">feature_map</span><span class="p">)</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"><strong>Features</strong></th>
<th style="text-align: center;"><strong>Describe</strong></th>
<th style="text-align: center;"><strong>Coef.</strong></th>
<th style="text-align: center;"><strong>Std.Err</strong></th>
<th style="text-align: center;"><strong>z</strong></th>
<th style="text-align: center;"><strong>P&gt;|z|</strong></th>
<th style="text-align: center;"><strong>[ 0.025</strong></th>
<th style="text-align: center;"><strong>0.975 ]</strong></th>
<th style="text-align: center;"><strong>VIF</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">const</td>
<td style="text-align: center;">截距项</td>
<td style="text-align: center;">-0.8422</td>
<td style="text-align: center;">0.0940</td>
<td style="text-align: center;">-8.9567</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">-1.0265</td>
<td style="text-align: center;">-0.6579</td>
<td style="text-align: center;">1.0464</td>
</tr>
<tr>
<td style="text-align: center;">status_of_existing_checking_account</td>
<td style="text-align: center;">现有支票账户的状态</td>
<td style="text-align: center;">0.8083</td>
<td style="text-align: center;">0.1549</td>
<td style="text-align: center;">5.2191</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.5048</td>
<td style="text-align: center;">1.1119</td>
<td style="text-align: center;">1.0565</td>
</tr>
<tr>
<td style="text-align: center;">credit_history</td>
<td style="text-align: center;">信用记录</td>
<td style="text-align: center;">0.8427</td>
<td style="text-align: center;">0.1823</td>
<td style="text-align: center;">4.6224</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.4854</td>
<td style="text-align: center;">1.2000</td>
<td style="text-align: center;">1.0754</td>
</tr>
<tr>
<td style="text-align: center;">purpose</td>
<td style="text-align: center;">目的</td>
<td style="text-align: center;">1.0387</td>
<td style="text-align: center;">0.2188</td>
<td style="text-align: center;">4.7462</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.6097</td>
<td style="text-align: center;">1.4676</td>
<td style="text-align: center;">1.0186</td>
</tr>
<tr>
<td style="text-align: center;">credit_amount</td>
<td style="text-align: center;">信用额度</td>
<td style="text-align: center;">1.0188</td>
<td style="text-align: center;">0.2345</td>
<td style="text-align: center;">4.3456</td>
<td style="text-align: center;">0.0000</td>
<td style="text-align: center;">0.5593</td>
<td style="text-align: center;">1.4784</td>
<td style="text-align: center;">1.0220</td>
</tr>
<tr>
<td style="text-align: center;">present_employment_since</td>
<td style="text-align: center;">现居住地至今</td>
<td style="text-align: center;">0.7043</td>
<td style="text-align: center;">0.3693</td>
<td style="text-align: center;">1.9074</td>
<td style="text-align: center;">0.0565</td>
<td style="text-align: center;">-0.0194</td>
<td style="text-align: center;">1.4281</td>
<td style="text-align: center;">1.0620</td>
</tr>
<tr>
<td style="text-align: center;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: center;">分期付款率占可支配收入的百分比</td>
<td style="text-align: center;">1.3074</td>
<td style="text-align: center;">0.4023</td>
<td style="text-align: center;">3.2496</td>
<td style="text-align: center;">0.0012</td>
<td style="text-align: center;">0.5189</td>
<td style="text-align: center;">2.0960</td>
<td style="text-align: center;">1.0192</td>
</tr>
<tr>
<td style="text-align: center;">personal_status_and_sex</td>
<td style="text-align: center;">个人地位和性别</td>
<td style="text-align: center;">0.8170</td>
<td style="text-align: center;">0.4786</td>
<td style="text-align: center;">1.7071</td>
<td style="text-align: center;">0.0878</td>
<td style="text-align: center;">-0.1211</td>
<td style="text-align: center;">1.7551</td>
<td style="text-align: center;">1.0058</td>
</tr>
<tr>
<td style="text-align: center;">age_in_years</td>
<td style="text-align: center;">年龄</td>
<td style="text-align: center;">0.7926</td>
<td style="text-align: center;">0.3023</td>
<td style="text-align: center;">2.6219</td>
<td style="text-align: center;">0.0087</td>
<td style="text-align: center;">0.2001</td>
<td style="text-align: center;">1.3852</td>
<td style="text-align: center;">1.0724</td>
</tr>
<tr>
<td style="text-align: center;">housing</td>
<td style="text-align: center;">住房情况</td>
<td style="text-align: center;">0.7277</td>
<td style="text-align: center;">0.4115</td>
<td style="text-align: center;">1.7684</td>
<td style="text-align: center;">0.0770</td>
<td style="text-align: center;">-0.0788</td>
<td style="text-align: center;">1.5342</td>
<td style="text-align: center;">1.0165</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">ITLubberLogisticRegression</span></code> 逻辑回归模型还支持直接通过画图查看模型系数稳定性</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 逻辑回归系数稳定情况</span>
<span class="n">logistic</span><span class="o">.</span><span class="n">plot_weights</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around;">
    <img src="https://itlubber.art/upload/sp_lr_weight.png" />
</div>
<p>同时，也提供了 <code class="docutils literal notranslate"><span class="pre">report</span></code> 方法快速查看模型在某个数据集（<code class="docutils literal notranslate"><span class="pre">woe</span></code>后的数据集）上的分类效果</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看某个数据集的分类效果</span>
<span class="n">logistic</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="p">)</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;"></th>
<th style="text-align: center;">desc</th>
<th style="text-align: center;">precision</th>
<th style="text-align: center;">recall</th>
<th style="text-align: center;">f1-score</th>
<th style="text-align: center;">support</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: center;">好客户</td>
<td style="text-align: center;">0.7785588752196837</td>
<td style="text-align: center;">0.9040816326530612</td>
<td style="text-align: center;">0.836638</td>
<td style="text-align: center;">490</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: center;">坏客户</td>
<td style="text-align: center;">0.6412213740458015</td>
<td style="text-align: center;">0.4</td>
<td style="text-align: center;">0.492669</td>
<td style="text-align: center;">210</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">macro avg</td>
<td style="text-align: center;">0.7098901246327426</td>
<td style="text-align: center;">0.6520408163265305</td>
<td style="text-align: center;">0.664653</td>
<td style="text-align: center;">700</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: center;">weighted avg</td>
<td style="text-align: center;">0.7373576248675191</td>
<td style="text-align: center;">0.7528571428571429</td>
<td style="text-align: center;">0.733447</td>
<td style="text-align: center;">700</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: center;">accuracy</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.752857</td>
<td style="text-align: center;">700</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>在模型分类报告中，<span class="math notranslate nohighlight">\(macro\ avg\)</span> 和 <span class="math notranslate nohighlight">\(weighted\ avg\)</span> 的计算方法如下:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(macro\ avg = \frac{metric_1 + metric_2}{2}\)</span></p>
<p><span class="math notranslate nohighlight">\(weighted\ avg = \frac{metric_1 \times \frac{support_1}{total\ count} + metric_2 \times \frac{support_2}{total\ count}}{2} = \frac{metric_1 \times support_1 + metric_2 \times support_2}{2 \times total\ count}\)</span></p>
</section>
<section id="id12">
<h2>评分卡转换</h2>
<p>在金融领域，如果直接使用模型预测的概率作为最终的评分，可能会对业务人员造成一定程度上的理解难度，同时，<a class="reference external" href="https://scikit-learn.org/stable/modules/calibration.html#calibration">模型预测的概率其实很难代表客户真实的违约概率</a>，不同模型预测的概率与真实违约概率之间存在不同程度的偏差。</p>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/sphx_glr_plot_compare_calibration_001.png" />
</div>
<p><span style="display: flex; justify-content: space-around; font-size: smaller;">不同模型预测概率与真实概率之间的偏差</span></p>
<p>由于模型预测概率与真实违约概率之间存在不同程度的偏差，评分卡不直接使用违约概率，而是引入了 <code class="docutils literal notranslate"><span class="pre">odds</span></code>（客户违约概率与正常概率的比值）来刻画客户的违约情况，其中 <span class="math notranslate nohighlight">\(odds = \frac{p}{1-p}\)</span> ，<span class="math notranslate nohighlight">\(p\)</span> 为模型预测的违约概率。</p>
<p>评分卡通常基于逻辑回归模型来制作，一方面是逻辑回归模型预测的违约概率与真实概率之间的偏差相比其他模型更接近，另一方面是逻辑回归模型能够很方便的转换为评分卡。</p>
<p>逻辑回归模型的数学公式如下:</p>
<div class="math notranslate nohighlight">
\[
p = \frac{1}{1+e^{-\theta^Tx}}
\]</div>
<p>根据逻辑回归的数学公式很容易推导出入模特征与 <code class="docutils literal notranslate"><span class="pre">odds</span></code> 之间的关系:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\frac{1}{p} &amp;= 1+e^{-\theta^Tx} \\
\frac{1}{p}-1 = \frac{1-p}{p} &amp;= e^{-\theta^Tx} \\
ln(\frac{p}{1-p}) = ln(odds) &amp;= \theta^Tx = \theta_0x_0 + \theta_1x_1 + \theta_2x_2 + ...... + \theta_nx_n
\end{aligned}
\end{split}\]</div>
<p>评分卡模型是在原有模型预测的违约概率 <span class="math notranslate nohighlight">\(p\)</span> 的基础上计算 <span class="math notranslate nohighlight">\(odds\)</span>，再根据 <span class="math notranslate nohighlight">\(ln(odds)\)</span> 进行平移和伸缩变换得到最终评分卡分数的模型，本质上是一种将 <span class="math notranslate nohighlight">\([0,\ 1]\)</span> 概率空间映射到实数空间 <span class="math notranslate nohighlight">\(R\)</span> 的一种方法。</p>
<p>假设评分卡模型数学形式如下：</p>
<div class="math notranslate nohighlight">
\[
score = A - B \times ln(odds) = A - B \times ln(\frac{p}{1-p}) = A - B \times (\theta_0x_0 + \theta_1x_1 + \theta_2x_2 + ...... + \theta_nx_n)
\]</div>
<p>假设客户违约概率为 <span class="math notranslate nohighlight">\(p_0\)</span> ，<span class="math notranslate nohighlight">\(base\_odds=p_0/(1-p_0)\)</span> 时，对应的评分卡分数为 <span class="math notranslate nohighlight">\(base\_score\)</span> ，当 <span class="math notranslate nohighlight">\(odds\)</span> 增加 <span class="math notranslate nohighlight">\(rate\)</span> 倍时，评分卡分数降低 <span class="math notranslate nohighlight">\(pdo\)</span> 分，可以得到一个二元一次方程:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\left\{
\begin{aligned}
base\_score &amp;= A - B \times ln(base\_odds) \\
base\_score - pdo &amp;= A - B \times ln(rate \times base\_odds)
\end{aligned}
\right.
\end{split}\]</div>
<p>根据上述二元一次方程求解可以得到:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
B &amp;= pdo / ln(rate) \\
A &amp;= base\_score + \frac{pdo}{ln(rate)} \times ln(base\_odds)
\end{aligned}
\end{split}\]</div>
<blockquote>
<div><p><strong>注:</strong> 在 <code class="docutils literal notranslate"><span class="pre">toad</span></code> 中使用的是 <span class="math notranslate nohighlight">\(woe = ln(\frac{good_i}{good}/\frac{bad_i}{bad})\)</span> ，在上述推导中符号是反的，故而在 <code class="docutils literal notranslate"><span class="pre">toad</span></code> 库中的 <code class="docutils literal notranslate"><span class="pre">offset</span> <span class="pre">=</span> <span class="pre">base_score</span> <span class="pre">-</span> <span class="pre">factor</span> <span class="pre">*</span> <span class="pre">np.log(base_odds)</span></code>，形式上的差异并不会导致最终 <code class="docutils literal notranslate"><span class="pre">A</span></code> 和 <code class="docutils literal notranslate"><span class="pre">B</span></code> 的值，但在计算 <span class="math notranslate nohighlight">\(base\_odds\)</span> 时需要注意使用对应的方式进行计算</p>
</div></blockquote>
<p>当计算得到 <span class="math notranslate nohighlight">\(A\)</span> 和 <span class="math notranslate nohighlight">\(B\)</span> 后，概率转评分的模型也就确定了，下面我们正式进入评分转换方法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 逻辑回归模型转评分卡</span>
<span class="n">card</span> <span class="o">=</span> <span class="n">ScoreCard</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">,</span> <span class="n">transer</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">pretrain_lr</span><span class="o">=</span><span class="n">logistic</span><span class="p">,</span> <span class="n">base_score</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">base_odds</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">pdo</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># 传入 woe 数据计算评分卡参数</span>
<span class="n">card</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="p">)</span>

<span class="c1"># 预测评分</span>
<span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">test</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中提供了输出评分卡刻度的方法 <code class="docutils literal notranslate"><span class="pre">scorecard_scale</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 输出评分卡刻度信息</span>
<span class="n">card</span><span class="o">.</span><span class="n">scorecard_scale</span><span class="p">()</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">序号</th>
<th style="text-align: left;">刻度项</th>
<th style="text-align: center;">刻度值</th>
<th style="text-align: left;">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: left;">base_odds</td>
<td style="text-align: center;">20</td>
<td style="text-align: left;">根据业务经验设置的基础比率（违约概率/正常概率），估算方法：（1-样本坏客户占比）/坏客户占比</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">base_score</td>
<td style="text-align: center;">50</td>
<td style="text-align: left;">基础ODDS对应的分数</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">rate</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">设置分数的倍率</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">pdo</td>
<td style="text-align: center;">10</td>
<td style="text-align: left;">表示分数增长PDO时，ODDS值增长到RATE倍</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: left;">B</td>
<td style="text-align: center;">14.427</td>
<td style="text-align: left;">补偿值，计算方式：pdo / ln(rate)</td>
</tr>
<tr>
<td style="text-align: center;">5</td>
<td style="text-align: left;">A</td>
<td style="text-align: center;">6.78072</td>
<td style="text-align: left;">刻度，计算方式：base_score - B * ln(base_odds)</td>
</tr>
</tbody>
</table>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中也提供了输出评分卡刻度的方法 <code class="docutils literal notranslate"><span class="pre">scorecard_points</span></code> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 输出评分卡刻度信息</span>
<span class="n">card</span><span class="o">.</span><span class="n">scorecard_points</span><span class="p">()</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: right;">序号</th>
<th style="text-align: left;">变量名称</th>
<th style="text-align: left;">变量分箱</th>
<th style="text-align: right;">对应分数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">0</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">no checking account</td>
<td style="text-align: right;">21.3836</td>
</tr>
<tr>
<td style="text-align: right;">1</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">... &gt;= 200 DM / salary assignments for at least 1 year,nan</td>
<td style="text-align: right;">6.0824</td>
</tr>
<tr>
<td style="text-align: right;">2</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">0 &lt;= ... &lt; 200 DM</td>
<td style="text-align: right;">-0.3605</td>
</tr>
<tr>
<td style="text-align: right;">3</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">... &lt; 0 DM</td>
<td style="text-align: right;">-5.0818</td>
</tr>
<tr>
<td style="text-align: right;">4</td>
<td style="text-align: left;">purpose</td>
<td style="text-align: left;">car (used),radio/television</td>
<td style="text-align: right;">12.0818</td>
</tr>
<tr>
<td style="text-align: right;">5</td>
<td style="text-align: left;">purpose</td>
<td style="text-align: left;">retraining,furniture/equipment,education,business,nan,car (new),repairs,domestic appliances,others</td>
<td style="text-align: right;">2.3125</td>
</tr>
<tr>
<td style="text-align: right;">6</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[-inf ~ 1382.0)</td>
<td style="text-align: right;">2.4344</td>
</tr>
<tr>
<td style="text-align: right;">7</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[1382.0 ~ 3804.0)</td>
<td style="text-align: right;">13.6608</td>
</tr>
<tr>
<td style="text-align: right;">8</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[3804.0 ~ inf)</td>
<td style="text-align: right;">-2.9765</td>
</tr>
<tr>
<td style="text-align: right;">9</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">... &gt;= 1000 DM,500 &lt;= ... &lt; 1000 DM,unknown/ no savings account</td>
<td style="text-align: right;">12.0593</td>
</tr>
<tr>
<td style="text-align: right;">10</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">nan</td>
<td style="text-align: right;">5.4614</td>
</tr>
<tr>
<td style="text-align: right;">11</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">100 &lt;= ... &lt; 500 DM,... &lt; 100 DM</td>
<td style="text-align: right;">2.5373</td>
</tr>
<tr>
<td style="text-align: right;">12</td>
<td style="text-align: left;">present_employment_since</td>
<td style="text-align: left;">4 &lt;= ... &lt; 7 years,... &gt;= 7 years</td>
<td style="text-align: right;">9.1647</td>
</tr>
<tr>
<td style="text-align: right;">13</td>
<td style="text-align: left;">present_employment_since</td>
<td style="text-align: left;">1 &lt;= ... &lt; 4 years,nan,unemployed,... &lt; 1 year</td>
<td style="text-align: right;">3.2488</td>
</tr>
<tr>
<td style="text-align: right;">14</td>
<td style="text-align: left;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: left;">[-inf ~ 4.0)</td>
<td style="text-align: right;">7.997</td>
</tr>
<tr>
<td style="text-align: right;">15</td>
<td style="text-align: left;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: left;">[4.0 ~ inf)</td>
<td style="text-align: right;">0.6935</td>
</tr>
<tr>
<td style="text-align: right;">16</td>
<td style="text-align: left;">personal_status_and_sex</td>
<td style="text-align: left;">female : divorced/separated/married,nan</td>
<td style="text-align: right;">7.4426</td>
</tr>
<tr>
<td style="text-align: right;">17</td>
<td style="text-align: left;">personal_status_and_sex</td>
<td style="text-align: left;">male : single,male : divorced/separated,male : married/widowed</td>
<td style="text-align: right;">3.122</td>
</tr>
<tr>
<td style="text-align: right;">18</td>
<td style="text-align: left;">property</td>
<td style="text-align: left;">real estate</td>
<td style="text-align: right;">10.5651</td>
</tr>
<tr>
<td style="text-align: right;">19</td>
<td style="text-align: left;">property</td>
<td style="text-align: left;">building society savings agreement/ life insurance,nan,car or other, not in attribute Savings account/bonds,unknown / no property</td>
<td style="text-align: right;">3.5272</td>
</tr>
<tr>
<td style="text-align: right;">20</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">[-inf ~ 23.0)</td>
<td style="text-align: right;">6.0181</td>
</tr>
<tr>
<td style="text-align: right;">21</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">[23.0 ~ 35.0)</td>
<td style="text-align: right;">-0.7208</td>
</tr>
<tr>
<td style="text-align: right;">22</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">[35.0 ~ inf)</td>
<td style="text-align: right;">11.0045</td>
</tr>
<tr>
<td style="text-align: right;">23</td>
<td style="text-align: left;">housing</td>
<td style="text-align: left;">nan,own</td>
<td style="text-align: right;">6.1523</td>
</tr>
<tr>
<td style="text-align: right;">24</td>
<td style="text-align: left;">housing</td>
<td style="text-align: left;">rent,for free</td>
<td style="text-align: right;">1.6267</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 还提供了一些方法，让您可以快速查看评分效果和分布情况:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看 KS 和 ROC 曲线</span>
<span class="n">ks_plot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Train Dataset&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/sp_train_ksplot.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/sp_train_ksplot.png" />
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看评分分布情况</span>
<span class="n">hist_plot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/sp_train_histplot.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/train_scorehist.png" />
</div>
<p>通过 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 提供的一些方法，您可以快速查看评分排序性，并得到相关的统计信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 训练集评分排序性</span>
<span class="n">score_clip</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">score_clip</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">clip</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># 计算等频分箱的间隔</span>
<span class="n">score_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;训练集模型评分&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">score_clip</span><span class="p">)</span> <span class="c1"># 计算统计信息</span>
<span class="n">bin_plot</span><span class="p">(</span><span class="n">score_table_train</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;训练集模型评分&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">anchor</span><span class="o">=</span><span class="mf">0.935</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_score_bins.png&quot;</span><span class="p">)</span> <span class="c1"># 画图</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: left;">指标名称</th>
<th style="text-align: left;">指标含义</th>
<th style="text-align: left;">分箱</th>
<th style="text-align: right;">样本总数</th>
<th style="text-align: right;">样本占比</th>
<th style="text-align: right;">好样本数</th>
<th style="text-align: right;">好样本占比</th>
<th style="text-align: right;">坏样本数</th>
<th style="text-align: right;">坏样本占比</th>
<th style="text-align: right;">坏样本率</th>
<th style="text-align: right;">分档WOE值</th>
<th style="text-align: right;">分档IV值</th>
<th style="text-align: right;">指标IV值</th>
<th style="text-align: right;">LIFT值</th>
<th style="text-align: right;">累积LIFT值</th>
<th style="text-align: right;">累积好样本数</th>
<th style="text-align: right;">累积坏样本数</th>
<th style="text-align: right;">分档KS值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">score</td>
<td style="text-align: left;">训练集模型评分</td>
<td style="text-align: left;">[负无穷 , 20)</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0128571</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.00204082</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.0380952</td>
<td style="text-align: right;">0.888889</td>
<td style="text-align: right;">-2.92677</td>
<td style="text-align: right;">0.105523</td>
<td style="text-align: right;">1.20035</td>
<td style="text-align: right;">2.96296</td>
<td style="text-align: right;">2.96296</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.0360544</td>
</tr>
<tr>
<td style="text-align: left;">score</td>
<td style="text-align: left;">训练集模型评分</td>
<td style="text-align: left;">[20 , 40)</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">0.228571</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">0.128571</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">0.461905</td>
<td style="text-align: right;">0.60625</td>
<td style="text-align: right;">-1.27888</td>
<td style="text-align: right;">0.426292</td>
<td style="text-align: right;">1.20035</td>
<td style="text-align: right;">2.02083</td>
<td style="text-align: right;">2.07101</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">0.369388</td>
</tr>
<tr>
<td style="text-align: left;">score</td>
<td style="text-align: left;">训练集模型评分</td>
<td style="text-align: left;">[40 , 60)</td>
<td style="text-align: right;">283</td>
<td style="text-align: right;">0.404286</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">0.402041</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">0.409524</td>
<td style="text-align: right;">0.303887</td>
<td style="text-align: right;">-0.0184439</td>
<td style="text-align: right;">0.000138015</td>
<td style="text-align: right;">1.20035</td>
<td style="text-align: right;">1.01296</td>
<td style="text-align: right;">1.40855</td>
<td style="text-align: right;">261</td>
<td style="text-align: right;">191</td>
<td style="text-align: right;">0.376871</td>
</tr>
<tr>
<td style="text-align: left;">score</td>
<td style="text-align: left;">训练集模型评分</td>
<td style="text-align: left;">[60 , 80)</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">0.267143</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">0.346939</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0.0809524</td>
<td style="text-align: right;">0.0909091</td>
<td style="text-align: right;">1.45527</td>
<td style="text-align: right;">0.387083</td>
<td style="text-align: right;">1.20035</td>
<td style="text-align: right;">0.30303</td>
<td style="text-align: right;">1.08503</td>
<td style="text-align: right;">431</td>
<td style="text-align: right;">208</td>
<td style="text-align: right;">0.110884</td>
</tr>
<tr>
<td style="text-align: left;">score</td>
<td style="text-align: left;">训练集模型评分</td>
<td style="text-align: left;">[80 , 正无穷)</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">0.0871429</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">0.120408</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.00952381</td>
<td style="text-align: right;">0.0327869</td>
<td style="text-align: right;">2.53699</td>
<td style="text-align: right;">0.281312</td>
<td style="text-align: right;">1.20035</td>
<td style="text-align: right;">0.10929</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">490</td>
<td style="text-align: right;">210</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/train_score_bins.png" />
</div>
<p>除了在单个数据集上查看评分效果，评分卡的稳定性也是一个重要的评估指标，<code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 内提供了查看两个数据集某个特征的 <code class="docutils literal notranslate"><span class="pre">PSI</span></code> 指标，同时针对评分卡模型，也提供了查看入模特征 <code class="docutils literal notranslate"><span class="pre">CSI</span></code> 的方法:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 查看某个特征的 PSI</span>
<span class="n">score_clip</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">score_clip</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">clip</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">score_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;训练集模型评分&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">score_clip</span><span class="p">)</span>
<span class="n">score_table_test</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;测试集模型评分&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">score_clip</span><span class="p">)</span>
<span class="n">train_test_score_psi</span> <span class="o">=</span> <span class="n">psi_plot</span><span class="p">(</span><span class="n">score_table_train</span><span class="p">,</span> <span class="n">score_table_test</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_test_psiplot.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 查看某个入模特征的 CSI</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">card</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">:</span>
    <span class="n">feature_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;训练集分布&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">feature_table_test</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;测试集分布&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">train_test_csi_table</span> <span class="o">=</span> <span class="n">csi_plot</span><span class="p">(</span><span class="n">feature_table_train</span><span class="p">,</span> <span class="n">feature_table_test</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;model_report/csi_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/train_test_psiplot.png" />
</div>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/csi_status_of_existing_checking_account.png" />
</div>
</section>
<section id="id13">
<h2>模型持久化存储</h2>
<p><code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 提供了几种可选的模型持久化存储方式，可以将训练好的评分卡模型保存为 <code class="docutils literal notranslate"><span class="pre">pickle</span></code> 或 <code class="docutils literal notranslate"><span class="pre">pmml</span></code> 格式的模型文件，供后续生产部署或离线回溯使用，非常方便快捷</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 将评分卡模型保存 pmml 文件</span>
<span class="n">scorecard_pipeline</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">scorecard2pmml</span><span class="p">(</span><span class="n">pmml</span><span class="o">=</span><span class="s2">&quot;model_report/scorecard.pmml&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># 将评分卡模型保存 pickle 文件</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s2">&quot;model_report/scorecard.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pipeline">
<h2>评分卡 <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> 建模</h2>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中，几乎所以的模型和数据预处理步骤都支持 <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> 式构建模型，同时还可以与 <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> 中其他的 <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> 组件一起构建模型。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 构建 pipeline</span>
<span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">FeatureSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;scorecardpy&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;combiner&quot;</span><span class="p">,</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">min_bin_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">WOETransformer</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;processing_select&quot;</span><span class="p">,</span> <span class="n">FeatureSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;toad&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;stepwise&quot;</span><span class="p">,</span> <span class="n">StepwiseSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span> <span class="n">ITLubberLogisticRegression</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
<span class="p">])</span>
<span class="c1"># 训练 pipeline</span>
<span class="n">model_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="c1"># 转换评分卡</span>
<span class="n">card</span> <span class="o">=</span> <span class="n">ScoreCard</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">model_pipeline</span><span class="p">,</span> <span class="n">base_score</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">base_odds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bad_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">bad_rate</span><span class="p">,</span> <span class="n">pdo</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">card</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">card</span><span class="o">.</span><span class="n">scorecard_points</span><span class="p">()</span>
</pre></div>
</div>
<table border="1" class="docutils">
<thead>
<tr>
<th style="text-align: center;">序号</th>
<th style="text-align: left;">变量名称</th>
<th style="text-align: left;">变量分箱</th>
<th style="text-align: right;">对应分数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">0</td>
<td style="text-align: left;">purpose</td>
<td style="text-align: left;">radio/television,car (used)</td>
<td style="text-align: right;">12.8514</td>
</tr>
<tr>
<td style="text-align: center;">1</td>
<td style="text-align: left;">purpose</td>
<td style="text-align: left;">business,furniture/equipment,others,education,domestic appliances,retraining,car (new),缺失值,repairs</td>
<td style="text-align: right;">2.7818</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: left;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: left;">[负无穷 , 4.0)</td>
<td style="text-align: right;">7.7878</td>
</tr>
<tr>
<td style="text-align: center;">3</td>
<td style="text-align: left;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: left;">[4.0 , 正无穷)</td>
<td style="text-align: right;">0.9877</td>
</tr>
<tr>
<td style="text-align: center;">4</td>
<td style="text-align: left;">installment_rate_in_percentage_of_disposable_income</td>
<td style="text-align: left;">缺失值</td>
<td style="text-align: right;">10.7462</td>
</tr>
<tr>
<td style="text-align: center;">5</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">500 &lt;= ... &lt; 1000 DM,unknown/ no savings account,... &gt;= 1000 DM</td>
<td style="text-align: right;">5.9834</td>
</tr>
<tr>
<td style="text-align: center;">6</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">... &lt; 100 DM,100 &lt;= ... &lt; 500 DM</td>
<td style="text-align: right;">12.1585</td>
</tr>
<tr>
<td style="text-align: center;">7</td>
<td style="text-align: left;">savings_account_and_bonds</td>
<td style="text-align: left;">缺失值</td>
<td style="text-align: right;">3.2466</td>
</tr>
<tr>
<td style="text-align: center;">8</td>
<td style="text-align: left;">present_employment_since</td>
<td style="text-align: left;">4 &lt;= ... &lt; 7 years,... &gt;= 7 years</td>
<td style="text-align: right;">9.4896</td>
</tr>
<tr>
<td style="text-align: center;">9</td>
<td style="text-align: left;">present_employment_since</td>
<td style="text-align: left;">缺失值,unemployed,1 &lt;= ... &lt; 4 years,... &lt; 1 year</td>
<td style="text-align: right;">3.8957</td>
</tr>
<tr>
<td style="text-align: center;">10</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">[负无穷 , 35.0)</td>
<td style="text-align: right;">0.8917</td>
</tr>
<tr>
<td style="text-align: center;">11</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">[35.0 , 正无穷)</td>
<td style="text-align: right;">10.8457</td>
</tr>
<tr>
<td style="text-align: center;">12</td>
<td style="text-align: left;">age_in_years</td>
<td style="text-align: left;">缺失值</td>
<td style="text-align: right;">6.7213</td>
</tr>
<tr>
<td style="text-align: center;">13</td>
<td style="text-align: left;">property</td>
<td style="text-align: left;">real estate</td>
<td style="text-align: right;">11.2541</td>
</tr>
<tr>
<td style="text-align: center;">14</td>
<td style="text-align: left;">property</td>
<td style="text-align: left;">缺失值,building society savings agreement/ life insurance,unknown / no property,car or other, not in attribute Savings account/bonds</td>
<td style="text-align: right;">4.0428</td>
</tr>
<tr>
<td style="text-align: center;">15</td>
<td style="text-align: left;">personal_status_and_sex</td>
<td style="text-align: left;">缺失值,female : divorced/separated/married</td>
<td style="text-align: right;">7.8997</td>
</tr>
<tr>
<td style="text-align: center;">16</td>
<td style="text-align: left;">personal_status_and_sex</td>
<td style="text-align: left;">male : single,male : married/widowed,male : divorced/separated</td>
<td style="text-align: right;">3.7463</td>
</tr>
<tr>
<td style="text-align: center;">17</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[负无穷 , 2145.0)</td>
<td style="text-align: right;">8.0057</td>
</tr>
<tr>
<td style="text-align: center;">18</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[2145.0 , 3804.0)</td>
<td style="text-align: right;">14.2751</td>
</tr>
<tr>
<td style="text-align: center;">19</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">[3804.0 , 正无穷)</td>
<td style="text-align: right;">-2.6347</td>
</tr>
<tr>
<td style="text-align: center;">20</td>
<td style="text-align: left;">credit_amount</td>
<td style="text-align: left;">缺失值</td>
<td style="text-align: right;">2.1778</td>
</tr>
<tr>
<td style="text-align: center;">21</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">no checking account</td>
<td style="text-align: right;">22.4653</td>
</tr>
<tr>
<td style="text-align: center;">22</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">缺失值,... &gt;= 200 DM / salary assignments for at least 1 year</td>
<td style="text-align: right;">6.6694</td>
</tr>
<tr>
<td style="text-align: center;">23</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">0 &lt;= ... &lt; 200 DM</td>
<td style="text-align: right;">0.0181</td>
</tr>
<tr>
<td style="text-align: center;">24</td>
<td style="text-align: left;">status_of_existing_checking_account</td>
<td style="text-align: left;">... &lt; 0 DM</td>
<td style="text-align: right;">-4.8558</td>
</tr>
</tbody>
</table>
</section>
<section id="id14">
<h2>评分卡全流程超参数搜索</h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 导入超参数搜索方法</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="c1"># 构建 pipeline</span>
<span class="n">model_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;preprocessing&quot;</span><span class="p">,</span> <span class="n">FeatureSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;scorecardpy&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;combiner&quot;</span><span class="p">,</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">min_bin_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">WOETransformer</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;processing_select&quot;</span><span class="p">,</span> <span class="n">FeatureSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;toad&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;stepwise&quot;</span><span class="p">,</span> <span class="n">StepwiseSelection</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span> <span class="n">ITLubberLogisticRegression</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)),</span>
<span class="p">])</span>

<span class="c1"># 定义超参数搜索空间，参数命名: {pipeline名称}__{对应超参数名称}</span>
<span class="n">params_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;combiner__max_n_bins&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;logistic__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
    <span class="s2">&quot;logistic__penalty&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l2&quot;</span><span class="p">],</span>
    <span class="s2">&quot;logistic__class_weight&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;balanced&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[{</span><span class="mi">1</span><span class="p">:</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
    <span class="s2">&quot;logistic__max_iter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;logistic__solver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sag&quot;</span><span class="p">],</span> <span class="c1"># [&quot;liblinear&quot;, &quot;sag&quot;, &quot;lbfgs&quot;, &quot;newton-cg&quot;],</span>
<span class="p">}</span>

<span class="n">pipeline_grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">,</span> <span class="n">params_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;roc_auc&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pipeline_grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pipeline_grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>

<span class="c1"># 更新模型</span>
<span class="n">model_pipeline</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="o">**</span><span class="n">pipeline_grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="n">model_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

<span class="c1"># 转换评分卡</span>
<span class="n">card</span> <span class="o">=</span> <span class="n">ScoreCard</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">model_pipeline</span><span class="p">,</span> <span class="n">base_score</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">base_odds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bad_rate</span><span class="p">)</span> <span class="o">/</span> <span class="n">bad_rate</span><span class="p">,</span> <span class="n">pdo</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">card</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model_pipeline</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="id15">
<h2>模型报告输出</h2>
<p>在 <code class="docutils literal notranslate"><span class="pre">scorecardpipeline</span></code> 中，提供了操作 <code class="docutils literal notranslate"><span class="pre">excel</span></code> 文件的写入器 <code class="docutils literal notranslate"><span class="pre">ExcelWriter</span></code>，支持将文字、表格、图像等过程内容保存至 <code class="docutils literal notranslate"><span class="pre">excel</span></code> 文件中，对相关方法抽象和封装后，能够满足日常大部分数据分析过程中结果保存的需求。</p>
<p><code class="docutils literal notranslate"><span class="pre">ExcelWriter</span></code>支持调整列宽、调整单元格格式、条件格式、指定位置插入数据、插入图片等功能，且提供了 <code class="docutils literal notranslate"><span class="pre">dataframe2excel</span></code> 来在日常工作中快速保存 <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> 至 <code class="docutils literal notranslate"><span class="pre">excel</span></code> 文件中，并且自动设置样式。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 初始化 Excel 写入器</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">ExcelWriter</span><span class="p">()</span>

<span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>

<span class="c1"># ////////////////////////////////////// 样本说明 ///////////////////////////////////// #</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_sheet_by_name</span><span class="p">(</span><span class="s2">&quot;汇总信息&quot;</span><span class="p">)</span>

<span class="c1"># 样本总体分布情况</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;样本总体分布情况&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">dataset_summary</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏客户占比&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 建模样本时间分布情况</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">distribution_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/all_sample_time_count.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;建模样本时间分布情况&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/all_sample_time_count.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">720</span><span class="p">,</span> <span class="mi">370</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;好样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本率&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;坏样本率&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span><span class="p">)</span>

<span class="c1"># ////////////////////////////////////// 模型报告 ///////////////////////////////////// #</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">logistic</span><span class="o">.</span><span class="n">summary2</span><span class="p">(</span><span class="n">feature_map</span><span class="o">=</span><span class="n">feature_map</span><span class="p">)</span>

<span class="c1"># 逻辑回归拟合情况</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_sheet_by_name</span><span class="p">(</span><span class="s2">&quot;逻辑回归拟合结果&quot;</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;逻辑回归拟合效果&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Coef.&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;训练数据集拟合报告&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">logistic</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="p">),</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1-score&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;测试数据集拟合报告&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">logistic</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">test_woe_stepwise</span><span class="p">),</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1-score&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># ////////////////////////////////////// 特征概述 ///////////////////////////////////// #</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_sheet_by_name</span><span class="p">(</span><span class="s2">&quot;模型变量信息&quot;</span><span class="p">)</span>

<span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;入模变量信息&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_df2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">feature_describe</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;序号&quot;</span><span class="p">}),</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">))</span>

<span class="c1"># 变量分布情况</span>
<span class="kn">import</span> <span class="nn">toad</span>
<span class="n">data_info</span> <span class="o">=</span> <span class="n">toad</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">card</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;变量名称&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;变量类型&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="s2">&quot;样本个数&quot;</span><span class="p">,</span> <span class="s2">&quot;missing&quot;</span><span class="p">:</span> <span class="s2">&quot;缺失值&quot;</span><span class="p">,</span> <span class="s2">&quot;unique&quot;</span><span class="p">:</span> <span class="s2">&quot;唯一值个数&quot;</span><span class="p">})</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;变量分布情况&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_df2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">data_info</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">))</span>

<span class="c1"># 变量相关性</span>
<span class="n">data_corr</span> <span class="o">=</span> <span class="n">train_woe_stepwise</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">logistic</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">train_woe_stepwise</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_corr.png&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;变量相关性&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/train_corr.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">500</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">data_corr</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}),</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">color_cols</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">data_corr</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 变量分箱信息</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;变量分箱信息&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">logistic</span><span class="o">.</span><span class="n">feature_names_in_</span><span class="p">:</span>
    <span class="n">feature_table</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">bin_plot</span><span class="p">(</span><span class="n">feature_table</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;model_report/bin_plots/data_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;model_report/bin_plots/data_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">feature_table</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;好样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;累积LIFT值&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span><span class="p">)</span>

<span class="c1"># ////////////////////////////////////// 评分卡说明 ///////////////////////////////////// #</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_sheet_by_name</span><span class="p">(</span><span class="s2">&quot;评分卡结果&quot;</span><span class="p">)</span>

<span class="c1"># 评分卡刻度</span>
<span class="n">scorecard_kedu</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">scorecard_scale</span><span class="p">()</span>
<span class="n">scorecard_points</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">scorecard_points</span><span class="p">(</span><span class="n">feature_map</span><span class="o">=</span><span class="n">feature_map</span><span class="p">)</span>
<span class="n">scorecard_clip</span> <span class="o">=</span> <span class="n">card</span><span class="o">.</span><span class="n">score_clip</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">clip</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;评分卡刻度&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_df2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">scorecard_kedu</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">))</span>

<span class="c1"># 评分卡对应分数</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;评分卡分数&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_df2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">scorecard_points</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">merge_column</span><span class="o">=</span><span class="s2">&quot;变量名称&quot;</span><span class="p">)</span>

<span class="c1"># 评分效果</span>
<span class="n">score_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;测试集模型评分&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">scorecard_clip</span><span class="p">)</span>
<span class="n">score_table_test</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;测试集模型评分&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="n">scorecard_clip</span><span class="p">)</span>

<span class="n">ks_plot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Train </span><span class="se">\t</span><span class="s2">Dataset&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_ksplot.png&quot;</span><span class="p">)</span>
<span class="n">ks_plot</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Test </span><span class="se">\t</span><span class="s2">Dataset&quot;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/test_ksplot.png&quot;</span><span class="p">)</span>

<span class="n">hist_plot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_scorehist.png&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">hist_plot</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">target</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/test_scorehist.png&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;训练数据集评分模型效果&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">ks_row</span> <span class="o">=</span> <span class="n">end_row</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/train_ksplot.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ks_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/train_scorehist.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ks_row</span><span class="p">,</span> <span class="n">end_col</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">score_table_train</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;好样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;累积LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;分档KS值&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;分档KS值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;测试数据集评分模型效果&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">ks_row</span> <span class="o">=</span> <span class="n">end_row</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/test_ksplot.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ks_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/test_scorehist.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ks_row</span><span class="p">,</span> <span class="n">end_col</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">score_table_test</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;好样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;累积LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;分档KS值&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFT值&quot;</span><span class="p">,</span> <span class="s2">&quot;分档KS值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># ////////////////////////////////////// 模型稳定性 ///////////////////////////////////// #</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">get_sheet_by_name</span><span class="p">(</span><span class="s2">&quot;模型稳定性&quot;</span><span class="p">)</span>
<span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span>

<span class="c1"># 评分分布稳定性</span>
<span class="n">train_test_score_psi</span> <span class="o">=</span> <span class="n">psi_plot</span><span class="p">(</span><span class="n">score_table_train</span><span class="p">,</span> <span class="n">score_table_test</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;model_report/train_test_psiplot.png&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;模型评分稳定性指标 (Population Stability Index, PSI): 训练数据集 vs 测试数据集&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="s2">&quot;model_report/train_test_psiplot.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">train_test_score_psi</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;训练数据集坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集坏样本率&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;分档PSI值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 变量 PSI 表</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">card</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">:</span>
    <span class="n">feature_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">feature_table_test</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">psi_table</span> <span class="o">=</span> <span class="n">psi_plot</span><span class="p">(</span><span class="n">feature_table_train</span><span class="p">,</span> <span class="n">feature_table_test</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;model_report/psi_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;model_report/psi_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">psi_table</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;训练数据集坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集% - 训练数据集%&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;分档PSI值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 变量 CSI 表</span>
<span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_value2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;入模变量稳定性指标 (Characteristic Stability Index, CSI): 训练数据集 vs 测试数据集&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">card</span><span class="o">.</span><span class="n">_feature_names</span><span class="p">:</span>
    <span class="n">feature_table_train</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">feature_table_test</span> <span class="o">=</span> <span class="n">feature_bin_stats</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">feature_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;逻辑回归入模变量&quot;</span><span class="p">,</span> <span class="n">combiner</span><span class="o">=</span><span class="n">combiner</span><span class="p">)</span>
    <span class="n">train_test_csi_table</span> <span class="o">=</span> <span class="n">csi_plot</span><span class="p">(</span><span class="n">feature_table_train</span><span class="p">,</span> <span class="n">feature_table_test</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">desc</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集&quot;</span><span class="p">],</span> <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;model_report/csi_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">insert_pic2sheet</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;model_report/csi_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">end_row</span><span class="p">,</span> <span class="n">start_col</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">end_row</span><span class="p">,</span> <span class="n">end_col</span> <span class="o">=</span> <span class="n">dataframe2excel</span><span class="p">(</span><span class="n">train_test_csi_table</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">worksheet</span><span class="p">,</span> <span class="n">percent_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;训练数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;训练数据集坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集样本占比&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集坏样本率&quot;</span><span class="p">,</span> <span class="s2">&quot;测试数据集% - 训练数据集%&quot;</span><span class="p">],</span> <span class="n">condition_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;分档CSI值&quot;</span><span class="p">],</span> <span class="n">start_row</span><span class="o">=</span><span class="n">end_row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 保存结果文件</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;model_report/评分卡模型报告.xlsx&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div style="display: flex; justify-content: space-around; ">
    <img width="100%" src="https://itlubber.art/upload/scorecardpipeline.png" />
</div>
</section>
</section>
<section id="id16">
<h1>交流</h1>
<div style="display: flex; justify-content: space-around;">
    <img width="30%" alt="itlubber" src="https://itlubber.art/upload/itlubber.png"/>
    <img width="30%" alt="itlubber_art" src="https://itlubber.art/upload/itlubber_art.png"/>
</div>
<div style="display: flex; justify-content: space-around; margin-bottom: 2rem;">
    <span>微信<code>: itlubber</code></span>
    <span>订阅号<code>: itlubber_art</code></span>
</div>
</section>

</article>
        
          <aside class="nftt-toc">
            <div class="mt-3 mb-1 my-lg-0 ps-xl-3 text-muted">
              <button class="btn btn-link link-dark p-md-0 mb-2 mb-md-0 text-decoration-none nftt-toc-toggle d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#tocContents" aria-expanded="false" aria-controls="tocContents"
              >On this page <i class="ms-2 bi bi-chevron-expand"></i></button>
              <div class="title d-none d-md-block">
                <i class="bi bi-file-earmark-text"></i>&nbsp;&nbsp;<span class="small">On this page</span>
              </div>
              <hr class="d-none d-md-block my-2">
              <div class="collapse nftt-toc-collapse" id="tocContents">
                <nav id="TableOfContents">
                  <ul>
<li><a class="reference internal" href="#">简介</a></li>
<li><a class="reference internal" href="#id2">版本说明</a></li>
<li><a class="reference internal" href="#id3">环境安装</a></li>
<li><a class="reference internal" href="#id4">使用示例</a><ul>
<li><a class="reference internal" href="#id5">导入依赖</a></li>
<li><a class="reference internal" href="#id6">数据准备</a></li>
<li><a class="reference internal" href="#id7">数据拆分</a></li>
<li><a class="reference internal" href="#id8">数据预处理</a><ul>
<li><a class="reference internal" href="#id9">特征筛选</a></li>
<li><a class="reference internal" href="#id10">特征分箱</a></li>
<li><a class="reference internal" href="#woe"><code class="docutils literal notranslate"><span class="pre">WOE</span></code> 转换</a></li>
<li><a class="reference internal" href="#id11">逐步回归特征筛选</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lr">训练 <code class="docutils literal notranslate"><span class="pre">LR</span></code> 模型</a></li>
<li><a class="reference internal" href="#id12">评分卡转换</a></li>
<li><a class="reference internal" href="#id13">模型持久化存储</a></li>
<li><a class="reference internal" href="#pipeline">评分卡 <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> 建模</a></li>
<li><a class="reference internal" href="#id14">评分卡全流程超参数搜索</a></li>
<li><a class="reference internal" href="#id15">模型报告输出</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">交流</a></li>
</ul>

                </nav>
              </div>
            </div>
          </aside>
        
      </main>
    </div>

    <footer class="nftt-footer">
      <nav id="paginator" class="py-4" aria-label="Documentation navigation">
    <div class="container">
      <ul class="pagination justify-content-between mb-0"><li class="page-item">
            <a href="index.html" class="d-flex px-5 align-items-end" rel="prev" aria-label="Previous page: scorecardpipeline">
              <span class="prev-page"><i class="bi bi-caret-left"></i></span>
              <div class="d-flex flex-column">
                <span class="text-small text-start text-muted">Previous</span>
                <span class="underline">scorecardpipeline</span>
              </div>
            </a>
          </li>
        <li class="page-item ms-auto">
            <a href="scorecardpipeline.html" class="d-flex px-5 align-items-end" rel="next" aria-label="Next page: scorecardpipeline">
              <div class="d-flex flex-column">
                <span class="text-small text-end text-start text-muted">Next</span>
                <span class="underline">scorecardpipeline</span>
              </div>
              <span class="next-page"><i class="bi bi-caret-right"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
  </nav>

      <div class="py-5 px-4 px-md-3">
  <div class="container">
    
    <div class="row">
      <ul class="list-unstyled list-separator col-lg-12 pb-2 text-center">
        
          
          
          <li class="d-inline">
            <a href="https://itlubber.art" class="list-item">itlubber</a>
          </li>
        
          
          
          <li class="d-inline">
            <a href="https://github.com/itlubber/scorecardpipeline" class="list-item">github</a>
          </li>
        
          
          
          <li class="d-inline">
            <a href="https://github.com/itlubber/scorecardpipeline/blob/main/examples/scorecard_samples.ipynb" class="list-item">examples</a>
          </li>
        
      </ul>
    </div>
    

    <div class="row">
      <div class="col-lg-12 text-center">
        <a class="brand-text d-inline-flex align-items-center mb-2 text-decoration-none" href="/" aria-label="Nefertiti-for-Sphinx">
          <span class="fs-6 fw-bold">scorecardpipeline</span>
        </a>
        
          <ul class="list-unstyled small text-muted">
            <li>2023, itlubber</li>
          </ul>
        
        
      </div>
    </div>
  </div>
</div>
    </footer>
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/translations.js"></script>
    <script src="_static/design-tabs.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script type="text/javascript" src="_static/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="_static/sphinx-nefertiti.min.js"></script>
    
  </body>
</html>